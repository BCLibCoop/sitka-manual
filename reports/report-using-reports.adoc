Using the Reporter
------------------

REPORTER WORKFLOW GOES HERE

* Clone templates from another user or Sitka_templates
* Run your report
** Reports can be set to run automatically on a recurring basis
* View your output
** Report output can be shared with staff accounts with reporter permissions

Cloning Report Templates
~~~~~~~~~~~~~~~~~~~~~~~~

////
[CAUTION]
=========
Cloning templates created on the old staff client (XUL in ui column) may not work perfectly. You 
may need to remove, then put back some fields during cloning.

IS THIS STILL TRUE?
=========
////


link:https://youtu.be/0F0dulXsUKw[*Cloning Reports and Sitka Templates (2:35)*]

In Evergreen reports are run from templates that be used multiple times.  Library staff can create their
own templates or clone templates from other users.

In order to clone a report template you must have already created at least one template folder.  See
xref:_creating_folders[].

. Go to *Administration* -> *Reports*
. In the _Shared Folders_ section click on the arrow beside the _Templates_ folder to see the shared
template folders. Continue to use the arrows to expand the folder tree until you find the folder containing
the template you would like to clone.
+
image::images/report/clone-report-template-1.png[]
+
. Click on the folder name to display the contents.
+
image::images/report/clone-report-template-2.png[]
+
. Check the box beside the template you wish to clone.
. From the drop down menu choose *Clone selected template*.  Click *Submit*. 
+
image::images/report/clone-report-template-3.png[]
+
[TIP]
=====
By default Evergreen only displays the first 10 items in any folder. To view all content,
change the _Limit output to_ setting from _10_ to _All_.
=====
+
. Click on the name of your folder where you'd like to save the cloned template and then 
click *Select Folder*. 
+
image::images/report/clone-report-template-4.png[]
+
. The template editor will open.  For information on modifying templates see 
xref:_modifying_report_templates[].
. Update the template name and/or template description if desired.
. Click *Save Template*
+
image::images/report/clone-report-template-5.png[]
+
. A pop-up will appear confirming that you wish to save the template.  Click *OK/Continue*.
. The template can now be found in the folder you saved it in.
+
image::images/report/clone-report-template-6.png[]


Running a Report
~~~~~~~~~~~~~~~~

link:https://youtu.be/9N22UxqOQlY[*Running a Report (4:25)*]

Through the reporter you can run one off reports right away as well as set up recurring reports that
automatically run on the interval you choose.  To run the report you fill out the reports form which
creates a report definition, which tells Evergreen how to run the report, what information to include,
and what type of output to provide you with.

. Go to *Administration* -> *Reports*
. In the _My Folders_ section click on the arrow beside the _Templates_ folder to see your 
template folders. Continue to use the arrows to expand the folder tree until you find the folder containing
the template you would like to use for your report.
+
image::images/report/reports-run-1.png[]
+
. Click on the folder name to display the contents.
+
image::images/report/reports-run-2.png[]
+
. Check the box beside the template you wish to use.
. *Create a new report from selected template* will be selected by default.  Click *Submit*. 
+
image::images/report/reports-run-3.png[]
+
. Enter a name for your report.
+
Optionally, enter a description for your report.
+
image::images/report/reports-run-4.png[]
+
. The report columns that will be on the report output are listed.
+
Pivot Label Column and Pivot Data Column are optional. Pivot tables are a different way to view data. If you
currently use pivot tables in MS Excel it is better to select an Excel output and continue using pivot tables
in Excel. Please note that Pivot tables are suitable to some result data only.
+
image::images/report/reports-run-5.png[]
+
. Choose the Reports folder you would like to save the reports definition in.
+
image::images/report/reports-run-6.png[]
+
. Enter values for any filters.  For more information on filter values see 
xref:_report_filters[].
+
image::images/report/reports-run-7.png[]
+
. Check the boxes to select the types of output you would like.
+
Check the _Calculate grouping subtotals_ check box to add an unlabeled row or column 
with the subtotals for each grouping and an unlabeled grand total row or column. Please note group 
subtotals and grand totals will only be useful with some reports.
+
image::images/report/reports-run-8.png[]
+
. Leave the recurring and run time options as is unless you are running a recurring report.  See
xref:_recurring_reports[].
+
image::images/report/reports-run-9.png[]
+
. Optionally enter an email address to send the report completion notification to.  By default this 
field will contain the email address saved in your staff account. Additional addresses can be added 
separated by a comma.
+
image::images/report/reports-run-10.png[]
+
[NOTE]
======
The email will contain a link to the password-protected report output. 
Only staff members with permissions to view reports or full access to the reporter will be able to 
open the report output. Staff who only need to view report
output must first to fill out the 
https://bc.libraries.coop/support/sitka/reporter-privacy-waiver/all-staff-reporter-privacy-waiver/[All
Staff Reporter Privacy Waiver].
======
+
. Choose the Ouput folder you would like to save the report output in and then click *Save Report*.
+
image::images/report/reports-run-11.png[]
+
. A pop-up appears confirming the report has been saved. Click *OK*.
. Unless you have set a specific run time the report will run right away.  If your report has not 
completed after 15 minutes please contact https://bc.libraries.coop/support/[Co-op Support].
. Once the report is complete you can view your output.  See xref:_viewing_report_output[]. 

Report Filters
++++++++++++++

The filters in a report template allow library staff to set the parameters on which the report runs. The
ability to select values for certain filters when running a report means a single report template can 
be used multiple times to generate reports on slightly different data.  For example, the same report 
template can be used to generate separate lists of items using particular circulation modifiers.

Hardcoded filters are set when the report template is created.  These filters cannot be changed when 
running a report. Common hardcoded filters include:


[options="header"]
|===
|Column |Transform |Action |User Params |Description 
|Bibliographic Record -> Record ID |Raw Data |Not in list |-1 | Exclude all records where
the bibliographic record ID is -1 which is all pre-cat records.
|Call Number/Volume -> Call Number/Volume ID |Raw Data |Not in list |-1 | Exclude all records where
the call number ID is -1 which is all pre-cat records.
|Circulation -> Check In Date/Time |Date |Is NULL| |Include only items that have not been checked in.
|Circulation -> Circulating Item -> Copy Status -> Name |Raw Data |Equals | name of an item status | Include
only items that are in the specified item status.
|Circulation -> Fine Stop Reason |Raw Data |Not in list |LOST | Exclude items that have stopped generating
fines because they have been set to lost.
|Item -> Is Deleted |Raw Data |Equals |f | Include only un-deleted items.
|ILS User -> Is Deleted |Raw Data |Equals |f | Include only un-deleted patrons.
|===

Date filters are generally set up to be a specific date, a specific month, or a date range. Date filters
will often include tips about how the dates should be entered. For instance, in a date range the earlier
date should always be entered in the first date box.
+
image::images/report/reports-filters-1.png[]
+
If you'd like to include all possible data for your library in a report that specifies a time range, 
enter between "1900-01-01" and "today's date".

When running recurring reports it's very important to use _Relative Dates_ in your filters.  This will
allow Evergreen to calculate the time period to report on each time it runs the report. A relative date of
1 month ago will generate a new report each month on the previous month's data; a real date of November
2022 will generate the same report each month with the data from November 2022.

Use the drop down menu to switch from _Real Date_ to _Relative Date_.  For a report filtering on month, you 
will be able to indicate how many months ago the report should look at.  
+
image::images/report/reports-filters-2.png[]

All report templates run by libraries will include a library filter.  This filter can look at the the 
library specified in a variety of fields in the data including the checkout library, circulation library,
owning library, patron's home library, and organizational unit. 
+
image::images/report/reports-filters-3.png[]
+
This filter is important as it allows 
staff to comply with Sitka's data requirements as per 
https://ln.sync.com/dl/ca731e4e0/view/doc/7839812630003#bw5v92du-w6q5j6uj-szy6shez-smwueqdv[Appendix J 
of the Service Management Agreement]
and restrict the data in the report output to only data relevant to their library.




+
The Transform for this field is Year + Month, so even if you choose a specific date (2018-09-20) it will
appear as the corresponding month only (2018-09).



[TIP]
=====
* The required value for filters should be in a format corresponding to the data transform. For example,
for a call number field transformed to First Continuous Non-space string, you need to put in the call
number prefix; for a field transformed to Count you need to give an integer. See xref:template_terminology[] for more on Data Transforms.
* *Action* corresponds to *Operator* used for filter fields. It specifies how the given value will be compared
with the field value. See xref:template_terminology[] for more on Operators.
* When creating a report, you may disable an unwanted filter in the template by choosing an appropriate
value for it. For example, ; select all copy statuses on the list to
bypass the filter on item status.
* If the calendar widget is not provided for a date filter, key in the date in format yyyy-mm-dd.
=====


* Always use relative date for recurring reports. Date is a filter on nearly every template. When setting up 
a recurring report, always choose *Relative Date*, instead of Real Date for any date filter on the report 
creating screen. 
+
If you use Real Date, you will have the same result every time, as the report is always generated based on the same condition.
+ 
image::images/report/recurring-2.png[]
+
* Once you have been on Evergreen for a year, you can set up your recurring monthly reports to show 
comparative data from one year ago. To do this select relative dates of 1 month ago and 13 months ago.

Recurring Reports
+++++++++++++++++

link:https://youtu.be/WS6vRrpqIZY[*Recurring Reports (3:02)*]

Recurring reports are a useful way to save time by scheduling reports that you run on a regular basis to 
run automatically. Monthly circulation and patron registration statistics are good candidates for recurring
reports.

Staff with access to the reporter can set up recurring reports to email a link to the password-protected 
report output to another staff member. Staff who only need to view report
output must first to fill out the 
https://bc.libraries.coop/support/sitka/reporter-privacy-waiver/all-staff-reporter-privacy-waiver/[All
Staff Reporter Privacy Waiver].


To set up a recurring report, follow the procedure in xref:_running_a_report[] until you reach
step 12 and then substitute the below steps.
 
. Check the box for *Recurring Report*.
. Select your desired _Recurrence Interval_. Reports can run on a daily, weekly, or monthly interval.
+
[TIP] 
=====
* The recurrence interval should correspond to the date filter. For example, if the template filters 
on a date instead of month, a recurring report running with a monthly interval may miss a day or capture 
an extra day's data. See xref:_report_filters for more information on working with date filters on
a recurring report.
=====
+
. Check the box beside the date and set the date of the first run of the report.
+
image::images/report/reports-recurring-1.png[]
+
[NOTE]
======
Best practice is to always set recurring reports to run in the early hours
of the morning (1:00am PT to 4:00am PT).

Monthly recurring reports MUST be set to run on the 1st of the next month in order to capture all monthly
data.
======
+
. Enter an email address to send the report completion notification to.  By default this 
field will contain the email address saved in your staff account. Additional addresses can be added 
separated by a comma.
+
image::images/report/reports-run-10.png[]
+
[NOTE]
======
The email will contain a link to the password-protected report output. 
Only staff members with permissions to view reports or full access to the reporter will be able to 
open the report output. Staff who only need to view report
output must first to fill out the 
https://bc.libraries.coop/support/sitka/reporter-privacy-waiver/all-staff-reporter-privacy-waiver/[All
Staff Reporter Privacy Waiver].
======
+
. Choose the Ouput folder you would like to save the report output in and then click *Save Report*.
+
image::images/report/reports-run-11.png[]
+
. A pop-up appears confirming the report has been saved. Click *OK*.
. Unless you have set a specific run time the report will run right away.  If your report has not 
completed after 15 minutes please contact https://bc.libraries.coop/support/[Co-op Support].
. Once the report is complete you can view your output.  See xref:_viewing_report_output[]. 
 
Viewing Report Output
~~~~~~~~~~~~~~~~~~~~~


link:https://youtu.be/SeAiy3jBVGg[*Viewing Report Output (2:08)*]

Viewing Output via the Reporter
+++++++++++++++++++++++++++++++

Once a report is finished, the output is stored in the specified Output folder and will remain there until
manually deleted. Evergreen sends an email with a link to the output if an email address(s) is supplied
when the report was set up.

. To view the report output in the staff client, open the reports module from
*Administration* -> *Reports*.
. Click on the arrow in front of *Output* to expand the folder. Click on *Circulation* (where you just saved the circulation report output) to display the output files in the right pane.
. Select the check box in front of *Sept 2018 circ stat*. *View report output* is the default selection in the drop down menu. Click *Submit*.
+
image::images/report/output-1.png[]
+
. A new tab will open for the report output. Select either Tabular Output or Excel Output. If Bar Charts was
selected during report definition the chart will also appear.
+
image::images/report/output-2.png[]
+
. Below is what the tabular output looks like. If needed, click *Back to output index* to select another output
format.
+
image::images/report/output-3.png[]
+
. If you want to manipulate, filter or graph this data, Excel output would be more useful. Click on Excel Output, you will be prompted to open or save the the output file.

Viewing Output via the Email Link
+++++++++++++++++++++++++++++++++


Managing Reports
~~~~~~~~~~~~~~~~

Once saved, reports stay there forever unless you delete them. When a report is deleted all the linked output
files will be deleted, too.

link:https://youtu.be/1CGqlSApwBs[*Managing Reports (3:02)*]

You may view or edit an existing report to change the values for filters, run-time, email reminder recipient, 
recurring interval, etc. For example, you may reschedule a recurring report to run on Mondays, 
instead of Thursdays. With this function, you may also generate a new report by editing and saving the report 
with a new name. 

You may edit a report from Reports or Output folder.
 
To view or edit a report in Reports folder, go to Reports folder to find the report that you wish to view/edit. 
Click View or Edit in the Edit column. We choose Edit in this example to change the reminder recipient's email address.

image::images/report/edit-report-1.png[]

The report is loaded on the report creation screen, where you make the required changes. In this example we edit the receipt's email address. 

image::images/report/edit-report-2.png[]

CAUTION: Right now you need to re-select values for filters using In List operator. 

Once done, click *Save Report*. Note that Evergreen 
will update the pending output only. The existing output will remain as is. You will see a prompt to choose *Apply Changes* to the pending output or *Save as New* to create a new report. 

image::images/report/edit-report-3.png[]

[TIP]
=====
It is not possible to modify a completed report. In fact, it is useless to attempt to edit a completed report, because the report has run and the output has been generated already. But you may generate a new report based on the conditions in a completed report. 

To create a new report, you need to enter a new report name or choose different report/output folders. Click *Save As New* at the bottom after finishing 
the editing. You can choose to create a one time or a recurring report.
=====

To edit a report in Output folder, go to Output to find the report. Click the report name. The details of the 
report show up in the line below. Click Edit.

image::images/report/edit-report-4.png[]

TIP: We suggest you edit recurring reports in the Pending Items in Output folder, as only the pending items are to be updated. 

When choosing View a report on the above two screens, the report will be displayed in non-editable mode.

* To stop a recurring report, you may delete the pending output 
from Pending area in Output folder. You may also delete the report from Report folder. But deleting the report 
will delete all the output files generated by it, too.
+
image::images/report/recurring-3.png[]
+ 
* Sometimes you may wish to make changes to a recurring 
report, e.g. the recurrence interval, generation date, email address to receive completion email, output 
format/folder or even filter values (such as the number of days overdue). You may do it by editing the report. 
See xref:edit_reports[] for details.



